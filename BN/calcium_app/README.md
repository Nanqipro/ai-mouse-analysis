# 钙信号分析应用 (Calcium Signal Analysis App)

## 📖 项目简介

这是一个分析钙离子荧光成像数据而设计的交互式Web应用。用户无需编程背景，即可通过图形化界面完成钙爆发事件的**提取**、**特征计算**和**聚类分析**。

本项目使用 Python 和 Streamlit 构建。

## ✨ 功能特性

-   **图形化界面**: 简洁直观的界面，所有操作通过点击和拖动完成。
-   **交互式参数调试**: 在事件提取阶段，可以实时预览不同参数对单个神经元事件提取效果的影响。
-   **批量处理**: 支持一次性上传并处理多个实验数据文件。
-   **无监督聚类**: 自动对提取的钙事件进行K-Means聚类，以发现不同类型的神经活动模式。
-   **丰富的数据可视化**:
    -   原始信号与平滑信号对比图
    -   事件提取结果标注图
    -   PCA / t-SNE 降维聚类散点图
    -   各聚类中事件特征的箱形分布图
-   **数据导出**: 所有分析结果（事件特征、聚类标签）均可一键下载为 Excel 文件。

## ⚙️ 运行环境与安装

为了保证应用稳定运行且不与您系统中的其他Python项目冲突，强烈建议使用 `conda` 创建一个独立的虚拟环境。

**步骤 1: 创建并激活 Conda 环境**

打开您的终端，然后运行以下命令：

```bash
# 创建一个名为 "calcium-env" 的新环境，并指定使用 Python 3.10
conda create --name calcium-env python=3.10 -y

# 激活新创建的环境
conda activate calcium-env
```

如果你没有安装conda，可以跳过这一步。

**步骤 2: 安装依赖库**

在激活 `calcium-env` 环境后，进入本项目的根目录，然后使用 `pip` 和 `requirements.txt` 文件安装所有必需的库：

```bash
pip install -r requirements.txt
```

## 🚀 如何使用

**步骤 1: 启动应用**

确保您已经激活了 `calcium-env` 环境，并且位于项目的根目录下。然后，在终端中运行以下命令：

```bash
python -m streamlit run calcium_app/app.py
```

执行后，您的默认浏览器会自动打开一个新的标签页，显示应用的欢迎界面。

**步骤 2: 页面操作指南**

应用包含两个主要页面，请按顺序使用：

**1. 🧪 事件提取**
   - 在左侧边栏，根据您的数据特性调整**采样频率**、**信噪比**等参数。
   - 点击"上传 Excel 文件"按钮，选择一个或多个您的原始数据文件。
   - （可选但推荐）**参数调试**: 上传文件后，从下拉菜单中选择一个神经元，点击"生成预览图"，观察当前参数下的提取效果，并据此优化参数。
   - 点击"**开始批量处理所有上传的文件**"按钮，程序将使用您设定的参数分析所有文件。
   - 分析完成后，您可以点击"下载结果文件"保存特征数据，该文件也会自动存放在 `calcium_app/results/` 目录下，供下一步使用。

**2. 🧩 聚类分析**
   - 进入此页面后，系统会自动从 `results` 文件夹中寻找并列出所有可用的特征文件。
   - 从下拉菜单中选择您想分析的文件。
   - 拖动滑块设置您希望的**聚类数 (K值)**。
   - 点击"**开始聚类分析**"按钮。
   - 查看生成的**降维散点图**、**特征分布图**和**统计摘要**。
   - 点击"下载带有聚类标签的Excel文件"以保存最终的分析结果。

## 📁 文件结构说明

-   `/calcium_app/app.py`: Streamlit 应用的主入口文件。
-   `/calcium_app/pages/`: 存放应用的各个页面（如事件提取、聚类分析）。
-   `/calcium_app/src/`: 存放核心的后端逻辑代码（如特征提取算法、聚类算法）。
-   `/calcium_app/uploads/`: 存放用户上传的原始数据文件（程序自动管理）。
-   `/calcium_app/results/`: 存放分析后生成的结果文件（如 `*_features.xlsx`）。
-   `/requirements.txt`: 项目所需的Python依赖库列表。
-   `/README.md`: 本说明文件。 