# 神经元数据分析Web工具

这是一个基于Web的可视化工具，用于分析小鼠神经元活动数据。用户可以通过浏览器界面选择不同的分析模块、上传数据文件、调节参数，并查看分析结果。

## 功能特性

### 支持的分析模块

1. **钙爆发事件聚类分析** (`cluster`)
   - 对神经元钙爆发事件进行聚类分析
   - 识别不同的活动模式
   - 支持自动确定最佳聚类数或手动指定

2. **行为热力图分析** (`heatmap`)
   - 生成特定行为前后时间窗口的神经元活动热力图
   - 支持多种神经元排序方式
   - 可分析行为序列

3. **神经元活动轨迹图** (`trace`)
   - 绘制神经元活动的时间序列轨迹图
   - 支持多种排序和显示选项
   - 可显示行为标注

4. **效应量计算** (`effect_size`)
   - 计算神经元在不同行为状态下的效应量
   - 生成效应量分布图和统计报告

5. **关键神经元分析** (`principal_neuron`)
   - 识别在特定行为状态下起关键作用的神经元
   - 生成神经元空间分布图
   - 分析神经元间的关系

### 主要功能

- **模块选择**: 直观的卡片式界面选择分析模块
- **文件上传**: 支持拖拽上传，自动验证文件格式
- **参数配置**: 动态生成参数配置界面，支持实时验证
- **进度监控**: 实时显示分析进度和状态
- **结果展示**: 支持图片预览和文件下载
- **多任务管理**: 支持同时运行多个分析任务

## 安装和运行

### 环境要求

- Python 3.8+
- 所需的Python包（见requirements.txt）

### 安装步骤

1. **克隆或下载项目**
   ```bash
   cd /path/to/ai-mouse-analysis/web_tool
   ```

2. **安装依赖包**
   ```bash
   pip install -r requirements.txt
   ```

3. **启动Web服务器**
   ```bash
   python run.py
   ```

4. **访问Web界面**
   - 打开浏览器访问: http://localhost:5000
   - 或在局域网内访问: http://[服务器IP]:5000

## 使用指南

### 基本使用流程

1. **选择分析模块**
   - 在左侧面板中点击选择要使用的分析模块
   - 查看模块详情，了解输入要求和输出结果

2. **上传数据文件**
   - 拖拽文件到上传区域或点击选择文件
   - 系统会自动验证文件格式和内容
   - 如果模块需要额外文件（如位置文件），会显示额外的上传选项

3. **配置参数**
   - 根据分析需求调整参数
   - 必需参数会标记为红色星号
   - 参数会进行实时验证

4. **开始分析**
   - 点击"开始分析"按钮
   - 系统会显示分析进度
   - 分析在后台异步进行

5. **查看结果**
   - 分析完成后会显示结果列表
   - 可以预览图片文件
   - 可以下载所有结果文件

### 数据文件格式要求

#### 通用要求
- 支持Excel (.xlsx) 和CSV (.csv) 格式
- 文件大小限制: 100MB
- 编码: UTF-8

#### 各模块具体要求

**聚类分析模块**:
- 必需列: `neuron`, `start_time`, `end_time`, `amplitude`, `duration`
- 数据类型: 钙爆发事件数据

**热力图分析模块**:
- 必需列: `stamp`, `behavior`, 神经元数据列
- 数据类型: 时间序列神经元活动数据

**轨迹图模块**:
- 必需列: `stamp`, 神经元数据列
- 可选列: `behavior`
- 数据类型: 时间序列神经元活动数据

**效应量计算模块**:
- 必需列: `behavior`, 神经元数据列
- 数据类型: 神经元活动与行为标签数据

**关键神经元分析模块**:
- 主文件必需列: `behavior`, 神经元数据列
- 位置文件必需列: `NeuronID`, `X`, `Y`
- 数据类型: 神经元活动数据 + 位置数据

### 示例数据

项目提供了示例数据文件:
- 位置: `/dataexample/29790930糖水铁网糖水trace2.xlsx`
- 包含: 时间戳、行为标签、神经元活动数据
- 可用于测试所有分析模块

## 技术架构

### 后端架构
- **Flask**: Web框架
- **模块适配器**: 统一的算法模块调用接口
- **异步处理**: 后台线程执行分析任务
- **文件管理**: 自动的文件上传和结果管理

### 前端架构
- **Bootstrap 5**: 响应式UI框架
- **原生JavaScript**: 前端交互逻辑
- **AJAX**: 异步API调用
- **拖拽上传**: 现代化的文件上传体验

### 目录结构
```
web_tool/
├── app.py                 # Flask主应用
├── run.py                 # 启动脚本
├── requirements.txt       # Python依赖
├── README.md             # 说明文档
├── config/               # 配置文件
│   └── modules_config.py # 模块配置
├── adapters/             # 算法模块适配器
│   └── module_adapter.py
├── templates/            # HTML模板
│   └── index.html
├── static/               # 静态文件
│   └── js/
│       └── app.js
├── uploads/              # 上传文件目录
└── results/              # 分析结果目录
```

## 故障排除

### 常见问题

1. **模块导入错误**
   - 确保算法模块路径正确
   - 检查Python路径配置

2. **文件上传失败**
   - 检查文件格式是否支持
   - 确认文件大小不超过限制
   - 验证文件内容格式

3. **分析失败**
   - 查看错误信息
   - 检查参数配置
   - 确认输入文件格式正确

4. **结果文件缺失**
   - 检查输出目录权限
   - 查看分析日志
   - 确认分析脚本正常运行

### 日志和调试

- Flask调试模式: 在`run.py`中设置`debug=True`
- 任务信息: 每个任务的详细信息保存在`results/{task_id}/task_info.json`
- 分析日志: 查看任务信息中的`stdout`和`stderr`字段

## 扩展开发

### 添加新的分析模块

1. **更新模块配置**
   - 在`config/modules_config.py`中添加新模块配置
   - 定义参数、输入要求、输出类型

2. **创建模块适配器**
   - 在`adapters/module_adapter.py`中创建新的适配器类
   - 实现`validate_input`和`run_analysis`方法
   - 在`AdapterFactory`中注册新适配器

3. **测试集成**
   - 准备测试数据
   - 验证参数配置
   - 测试完整的分析流程

### 自定义界面

- 修改`templates/index.html`调整页面布局
- 更新`static/js/app.js`添加新的交互功能
- 添加CSS样式文件自定义外观

## 许可证

本项目遵循MIT许可证。详见LICENSE文件。

## 联系方式

如有问题或建议，请联系开发团队。